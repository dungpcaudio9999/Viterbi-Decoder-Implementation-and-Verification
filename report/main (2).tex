\documentclass[12pt,a4paper]{report}

% ================= CẤU HÌNH GÓI LỆNH =================
\usepackage{fontspec}
\usepackage[vietnamese]{babel}
\setmainfont{Times New Roman}
\setmonofont{Consolas}

\usepackage{amsmath, amsfonts, amssymb} % Gói toán học
\usepackage{graphicx}   % Chèn ảnh
\graphicspath{{images/}} % Đường dẫn tới thư mục chứa ảnh
\usepackage{float}      % Định vị ảnh [H]
\usepackage{tabularx}   % Bảng biểu
\usepackage{longtable}  % Bảng dài qua trang
\usepackage{geometry}   % Căn lề
\usepackage{setspace}   % Giãn dòng
\usepackage{indentfirst}% Thụt đầu dòng đoạn đầu tiên
\usepackage{titlesec}   % Định dạng tiêu đề
\usepackage{hyperref}   % Tạo link mục lục
\usepackage{caption}    % Chú thích bảng/hình
% \usepackage{minted}     % (Tùy chọn) Chèn code đẹp, nhưng cần cài python-pygments. Dùng verbatim cho đơn giản.
\usepackage{listings}   % Chèn code

% Cấu hình hiển thị code
\lstset{
    basicstyle=\small\ttfamily,
    breaklines=true,
    frame=single,
    numbers=left,
    numberstyle=\tiny,
    tabsize=2,
    captionpos=b,
    keepspaces=true,
    commentstyle=\itshape\rmfamily
}

% Cấu hình lề trang
\geometry{left=3cm, right=2cm, top=2.5cm, bottom=2.5cm}

% Cấu hình Header/Footer
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{BTL Thiết kế VLSI}
\fancyhead[R]{Viterbi Decoder SoC}
\fancyfoot[C]{\thepage}

% Cấu hình tiêu đề chương
\titleformat{\chapter}[block]{\bfseries\Large}{\chaptertitlename\ \thechapter:}{0.5em}{}
\titlespacing*{\chapter}{0pt}{-20pt}{20pt}

% Cấu hình Hyperlink
\hypersetup{colorlinks=true, linkcolor=black, filecolor=magenta, urlcolor=blue}

\onehalfspacing % Giãn dòng 1.5

\begin{document}

% ====================================================================
% TRANG BÌA
% ====================================================================
\begin{titlepage}
    \begin{center}
        \textbf{\large ĐẠI HỌC BÁCH KHOA HÀ NỘI}\\
        \textbf{\large TRƯỜNG ĐIỆN – ĐIỆN TỬ}
        
        \vspace{1cm}
        \includegraphics[width=3cm]{hust_logo.png} 
        \vspace{1cm}
        
        {\bfseries \Huge BÀI TẬP LỚN \par}
        {\bfseries \Huge THIẾT KẾ VLSI \par}
        
        \vspace{1.5cm}
        
        {\bfseries \Large Đề tài: \\ THIẾT KẾ VÀ TỔNG HỢP HỆ THỐNG VITERBI DECODER \\ TỪ RTL ĐẾN GDSII SỬ DỤNG OPENLANE FLOW \par}
        
        \vspace{2cm}
        
        \begin{tabular}{ll}
            \textbf{Giảng viên hướng dẫn:} & TS. Nguyễn Vũ Thắng \\
            \textbf{Sinh viên thực hiện:}  & Phạm Chí Dũng – 20200106 \\
                                           & Võ Ngọc Vinh – 20227447 \\
                                           & Nguyễn Văn Dương – 20241713E \\
            \textbf{Lớp:}                  & 163187 – ET4340
        \end{tabular}
        
        \vfill
        \textbf{Hà Nội, 2026}
    \end{center}
\end{titlepage}

% ====================================================================
% TÓM TẮT
% ====================================================================
\chapter*{TÓM TẮT NỘI DUNG}
\addcontentsline{toc}{chapter}{TÓM TẮT NỘI DUNG}

Báo cáo này trình bày quy trình toàn diện về thiết kế, kiểm chứng và thực thi vật lý cho một hệ thống giải mã Viterbi (Viterbi Decoder SoC). Hệ thống được xây dựng hoàn chỉnh với các khối giao tiếp ngoại vi (FIFO, PISO, SIPO) để xử lý dữ liệu dòng. Điểm nổi bật của thiết kế là việc áp dụng kiến trúc \textbf{Register Exchange (RE)} trong đơn vị truy vết, giúp tối ưu hóa băng thông xử lý và giảm độ trễ so với phương pháp Traceback truyền thống.

Kết quả kiểm tra chức năng (Functional Verification) cho thấy mạch hoạt động chính xác tuyệt đối với bộ dữ liệu kiểm thử. Quy trình thiết kế vật lý (Physical Design) được thực hiện bằng công cụ mã nguồn mở \textbf{OpenLane Flow} với công nghệ Sky130, đạt kết quả khả quan về diện tích ($0.16 mm^2$), công suất tiêu thụ thấp và đáp ứng tốt các yêu cầu về thời gian (Timing) ở tần số 50MHz.

\newpage
\tableofcontents
\newpage

\listoffigures
\listoftables
\newpage

% ====================================================================
% CHƯƠNG 1
% ====================================================================
\chapter{TỔNG QUAN VỀ MÃ TÍCH CHẬP VÀ GIẢI MÃ VITERBI}

\section{Giới thiệu mã tích chập}
Mã tích chập (Convolutional Codes) là một lớp mã sửa lỗi quan trọng, trong đó luồng bit đầu ra được tạo ra từ việc thực hiện phép tích chập giữa luồng bit đầu vào với đáp ứng xung của các thanh ghi dịch. Một bộ mã hóa tích chập được đặc trưng bởi bộ tham số $(n, k, m)$, trong đó:
\begin{itemize}
    \item $k$: Số bit đầu vào tại mỗi nhịp thời gian.
    \item $n$: Số bit đầu ra tại mỗi nhịp thời gian.
    \item $m$: Độ sâu của bộ nhớ (số lượng thanh ghi dịch).
\end{itemize}
Độ dài giới hạn quan trọng $K = m + 1$ biểu thị số lượng bit đầu vào ảnh hưởng đến một bit đầu ra. Tỷ lệ mã $R = k/n$ biểu thị hiệu suất băng thông.

\section{Nguyên lý giải mã Viterbi}
Giải mã Viterbi là một giải thuật quy hoạch động dùng để tìm đường dẫn có khả năng xảy ra cao nhất (Maximum Likelihood Path) trên biểu đồ lưới (Trellis diagram). Quá trình giải mã gồm ba bước cơ bản:
\begin{enumerate}
    \item \textbf{Branch Metric Calculation}: Tính toán độ tương đồng giữa tín hiệu nhận được và tín hiệu lý thuyết trên mỗi nhánh.
    \item \textbf{Path Metric Update (ACS)}: Tại mỗi trạng thái, cộng Metric nhánh vào Metric đường dẫn tích lũy, so sánh và chọn đường dẫn tốt nhất (Survivor Path).
    \item \textbf{Survivor Path Memory}: Lưu trữ lịch sử quyết định để khôi phục lại chuỗi dữ liệu gốc.
\end{enumerate}

% ====================================================================
% CHƯƠNG 2
% ====================================================================
\chapter{ĐẶC TẢ KỸ THUẬT VÀ THIẾT KẾ RTL}

\section{Đặc tả kỹ thuật (Specifications)}
Dựa trên yêu cầu của đề tài, hệ thống Viterbi Decoder được thiết kế với các thông số kỹ thuật sau:

\begin{table}[H]
    \centering
    \caption{Các thông số thiết kế chính}
    \begin{tabular}{|l|l|}
    \hline
    \textbf{Tham số} & \textbf{Giá trị} \\ \hline
    Constraint Length ($K$) & 3 \\ \hline
    Code Rate ($R$) & 1/2 \\ \hline
    Generators (Octal) & $G_1 = 7_8 (111_2)$, $G_2 = 5_8 (101_2)$ \\ \hline
    Traceback Length ($L$) & 15 \\ \hline
    Architecture Type & Register Exchange (RE) \\ \hline
    Soft/Hard Decision & Hard Decision (1-bit quantization) \\ \hline
    \end{tabular}
\end{table}

Bảng tín hiệu giao tiếp của khối Top-Level (\texttt{system\_top}):

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{system_top.png}
    \caption{Sơ đồ khối Top-Level System}
    \label{fig:system_top_block}
\end{figure}

\begin{table}[H]
    \centering
    \caption{Đặc tả giao diện System Top}
    \begin{tabularx}{\textwidth}{|l|c|c|X|}
    \hline
    \textbf{Tên tín hiệu} & \textbf{Độ rộng} & \textbf{Hướng} & \textbf{Mô tả} \\ \hline
    \texttt{clk} & 1 & I & Xung clock hệ thống (Cạnh dương). \\ \hline
    \texttt{rst\_n} & 1 & I & Reset hệ thống (Tích cực thấp). \\ \hline
    \texttt{dvalid\_i} & 1 & I & Tín hiệu báo dữ liệu đầu vào hợp lệ (FIFO WrEn). \\ \hline
    \texttt{data\_i} & 16 & I & Gói dữ liệu đầu vào (16-bit). \\ \hline
    \texttt{data\_o} & 8 & O & Dữ liệu byte đã giải mã (8-bit). \\ \hline
    \texttt{valid\_o} & 1 & O & Tín hiệu báo dữ liệu đầu ra đã sẵn sàng. \\ \hline
    \texttt{busy\_o} & 1 & O & Báo bận khi bộ đệm FIFO đầy. \\ \hline
    \end{tabularx}
\end{table}

\section{Kiến trúc hệ thống và Chi tiết I/O từng khối}
Hệ thống được thiết kế theo luồng dữ liệu Pipeline để tối ưu hóa hiệu năng. Dưới đây là mô tả chi tiết các chân tín hiệu của từng thực thể chức năng.

\subsection{Khối đệm dữ liệu (FIFO)}
Khối này lưu trữ tạm thời dữ liệu 16-bit từ bên ngoài trước khi đưa vào bộ giải mã.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{fifo.png}
    \caption{Sơ đồ khối FIFO}
    \label{fig:fifo_block}
\end{figure}

\begin{table}[H]
    \centering
    \caption{Giao diện khối Sync FIFO}
    \begin{tabularx}{\textwidth}{|l|c|c|X|}
    \hline
    \textbf{Tên tín hiệu} & \textbf{Độ rộng} & \textbf{Hướng} & \textbf{Mô tả} \\ \hline
    \texttt{clk} & 1 & I & Xung clock hệ thống. \\ \hline
    \texttt{rst\_n} & 1 & I & Reset hệ thống (Tích cực thấp). \\ \hline
    \texttt{wr\_en\_i} & 1 & I & Lệnh ghi dữ liệu vào FIFO. \\ \hline
    \texttt{wr\_data\_i} & 16 & I & Dữ liệu 16-bit ghi vào. \\ \hline
    \texttt{full\_o} & 1 & O & Cờ báo bộ đệm đã đầy. \\ \hline
    \texttt{rd\_en\_i} & 1 & I & Lệnh đọc dữ liệu ra (từ PISO). \\ \hline
    \texttt{rd\_data\_o} & 16 & O & Dữ liệu 16-bit đọc ra. \\ \hline
    \texttt{empty\_o} & 1 & O & Cờ báo bộ đệm rỗng. \\ \hline
    \end{tabularx}
\end{table}

\subsection{Khối chuyển đổi song song sang nối tiếp (PISO)}
Chuyển đổi gói 16-bit thành các cặp 2-bit (symbol) để nạp vào Viterbi Core.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{piso.png}
    \caption{Sơ đồ khối PISO}
    \label{fig:piso_block}
\end{figure}

\begin{table}[H]
    \centering
    \caption{Giao diện khối PISO}
    \begin{tabularx}{\textwidth}{|l|c|c|X|}
    \hline
    \textbf{Tên tín hiệu} & \textbf{Độ rộng} & \textbf{Hướng} & \textbf{Mô tả} \\ \hline
    \texttt{clk} & 1 & I & Xung clock hệ thống. \\ \hline
    \texttt{rst\_n} & 1 & I & Reset hệ thống (Tích cực thấp). \\ \hline
    \texttt{fifo\_data\_i} & 16 & I & Dữ liệu nhận từ FIFO. \\ \hline
    \texttt{fifo\_empty\_i} & 1 & I & Trạng thái rỗng của FIFO. \\ \hline
    \texttt{fifo\_rd\_en\_o} & 1 & O & Lệnh yêu cầu FIFO xuất dữ liệu. \\ \hline
    \texttt{data\_serial\_o} & 2 & O & Cặp bit symbol gửi tới Core. \\ \hline
    \texttt{valid\_serial\_o}& 1 & O & Báo symbol hiện tại hợp lệ. \\ \hline
    \end{tabularx}
\end{table}

\subsection{Khối tính toán chi phí nhánh (BMU)}
Tính khoảng cách Hamming giữa cặp bit nhận được và các nhánh kỳ vọng trong đồ thị lưới.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{bmu.png}
    \caption{Sơ đồ khối BMU}
    \label{fig:bmu_block}
\end{figure}

\begin{table}[H]
    \centering
    \caption{Giao diện khối BMU}
    \begin{tabularx}{\textwidth}{|l|c|c|X|}
    \hline
    \textbf{Tên tín hiệu} & \textbf{Độ rộng} & \textbf{Hướng} & \textbf{Mô tả} \\ \hline
    \texttt{piso\_data\_i} & 2 & I & Dữ liệu 2-bit từ PISO. \\ \hline
    \texttt{bm\_s0\_s0\_o} & 2 & O & Chi phí nhánh từ S0 đến S0. \\ \hline
    \texttt{bm\_s0\_s2\_o} & 2 & O & Chi phí nhánh từ S0 đến S2. \\ \hline
    \texttt{bm\_s1\_s0\_o} & 2 & O & Chi phí nhánh từ S1 đến S0. \\ \hline
    \texttt{bm\_s1\_s2\_o} & 2 & O & Chi phí nhánh từ S1 đến S2. \\ \hline
    \texttt{bm\_s2\_s1\_o} & 2 & O & Chi phí nhánh từ S2 đến S1. \\ \hline
    \texttt{bm\_s2\_s3\_o} & 2 & O & Chi phí nhánh từ S2 đến S3. \\ \hline
    \texttt{bm\_s3\_s1\_o} & 2 & O & Chi phí nhánh từ S3 đến S1. \\ \hline
    \texttt{bm\_s3\_s3\_o} & 2 & O & Chi phí nhánh từ S3 đến S3. \\ \hline
    \end{tabularx}
\end{table}

\subsection{Khối Cộng - So sánh - Chọn (ACSU)}
Cập nhật Path Metric cho 4 trạng thái và đưa ra quyết định chọn đường dẫn (Survivor Path).

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{ascu.png}
    \caption{Sơ đồ khối ACSU}
    \label{fig:acsu_block}
\end{figure}

\begin{table}[H]
    \centering
    \caption{Giao diện khối ACSU}
    \begin{tabularx}{\textwidth}{|l|c|c|X|}
    \hline
    \textbf{Tên tín hiệu} & \textbf{Độ rộng} & \textbf{Hướng} & \textbf{Mô tả} \\ \hline
    \texttt{bm\_s0\_s0\_i} & 2 & I & Chi phí nhánh từ S0 đến S0. \\ \hline
    \texttt{bm\_s0\_s2\_i} & 2 & I & Chi phí nhánh từ S0 đến S2. \\ \hline
    \texttt{bm\_s1\_s0\_i} & 2 & I & Chi phí nhánh từ S1 đến S0. \\ \hline
    \texttt{bm\_s1\_s2\_i} & 2 & I & Chi phí nhánh từ S1 đến S2. \\ \hline
    \texttt{bm\_s2\_s1\_i} & 2 & I & Chi phí nhánh từ S2 đến S1. \\ \hline
    \texttt{bm\_s2\_s3\_i} & 2 & I & Chi phí nhánh từ S2 đến S3. \\ \hline
    \texttt{bm\_s3\_s1\_i} & 2 & I & Chi phí nhánh từ S3 đến S1. \\ \hline
    \texttt{bm\_s3\_s3\_i} & 2 & I & Chi phí nhánh từ S3 đến S3. \\ \hline
    \texttt{pm\_s0\_i} & 8 & I & Chi phí đường đi hiện tại của S0. \\ \hline
    \texttt{pm\_s1\_i} & 8 & I & Chi phí đường đi hiện tại của S1. \\ \hline
    \texttt{pm\_s2\_i} & 8 & I & Chi phí đường đi hiện tại của S2. \\ \hline
    \texttt{pm\_s3\_i} & 8 & I & Chi phí đường đi hiện tại của S3. \\ \hline
    \texttt{pm\_s0\_o} & 8 & O & Chi phí đường đi mới của S0. \\ \hline
    \texttt{pm\_s1\_o} & 8 & O & Chi phí đường đi mới của S1. \\ \hline
    \texttt{pm\_s2\_o} & 8 & O & Chi phí đường đi mới của S2. \\ \hline
    \texttt{pm\_s3\_o} & 8 & O & Chi phí đường đi mới của S3. \\ \hline
    \texttt{dec\_bits\_o} & 4 & O & 4 bit quyết định chọn nhánh (1 bit mỗi trạng thái). \\ \hline
    \end{tabularx}
\end{table}

\subsection{Khối quản lý Path Metric (PMU)}
Lưu trữ và phản hồi chi phí tích lũy của các trạng thái.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{pmu.png}
    \caption{Sơ đồ khối PMU}
    \label{fig:pmu_block}
\end{figure}

\begin{table}[H]
    \centering
    \caption{Giao diện khối PMU}
    \begin{tabularx}{\textwidth}{|l|c|c|X|}
    \hline
    \textbf{Tên tín hiệu} & \textbf{Độ rộng} & \textbf{Hướng} & \textbf{Mô tả} \\ \hline
    \texttt{clk} & 1 & I & Xung clock hệ thống. \\ \hline
    \texttt{rst\_n} & 1 & I & Reset hệ thống (Tích cực thấp). \\ \hline
    \texttt{valid\_i} & 1 & I & Cho phép cập nhật giá trị mới. \\ \hline
    \texttt{pm\_new\_s0\_i} & 8 & I & Giá trị mới từ ACSU cho S0. \\ \hline
    \texttt{pm\_new\_s1\_i} & 8 & I & Giá trị mới từ ACSU cho S1. \\ \hline
    \texttt{pm\_new\_s2\_i} & 8 & I & Giá trị mới từ ACSU cho S2. \\ \hline
    \texttt{pm\_new\_s3\_i} & 8 & I & Giá trị mới từ ACSU cho S3. \\ \hline
    \texttt{pm\_current\_s0\_o} & 8 & O & Giá trị hiện tại của S0 gửi ACSU. \\ \hline
    \texttt{pm\_current\_s1\_o} & 8 & O & Giá trị hiện tại của S1 gửi ACSU. \\ \hline
    \texttt{pm\_current\_s2\_o} & 8 & O & Giá trị hiện tại của S2 gửi ACSU. \\ \hline
    \texttt{pm\_current\_s3\_o} & 8 & O & Giá trị hiện tại của S3 gửi ACSU. \\ \hline
    \end{tabularx}
\end{table}

\subsection{Khối truy vết Survivor Memory (TBU - Register Exchange)}
Thực hiện kỹ thuật Register Exchange để khôi phục bit gốc từ các bit quyết định.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{tbu.png}
    \caption{Sơ đồ khối TBU}
    \label{fig:tbu_block}
\end{figure}

\begin{table}[H]
    \centering
    \caption{Giao diện khối TBU}
    \begin{tabularx}{\textwidth}{|l|c|c|X|}
    \hline
    \textbf{Tên tín hiệu} & \textbf{Độ rộng} & \textbf{Hướng} & \textbf{Mô tả} \\ \hline
    \texttt{clk} & 1 & I & Xung clock hệ thống. \\ \hline
    \texttt{rst\_n} & 1 & I & Reset hệ thống (Tích cực thấp). \\ \hline
    \texttt{valid\_i} & 1 & I & Tín hiệu cho phép cập nhật. \\ \hline
    \texttt{dec\_bits\_i} & 4 & I & Các bit quyết định từ ACSU. \\ \hline
    \texttt{pm\_new\_s0\_i} & 8 & I & Chi phí đường dẫn mới của S0 (để so sánh). \\ \hline
    \texttt{pm\_new\_s1\_i} & 8 & I & Chi phí đường dẫn mới của S1 (để so sánh). \\ \hline
    \texttt{pm\_new\_s2\_i} & 8 & I & Chi phí đường dẫn mới của S2 (để so sánh). \\ \hline
    \texttt{pm\_new\_s3\_i} & 8 & I & Chi phí đường dẫn mới của S3 (để so sánh). \\ \hline
    \texttt{decoded\_bit\_o}& 1 & O & Bit dữ liệu đã giải mã thành công. \\ \hline
    \texttt{valid\_o} & 1 & O & Báo bit giải mã hợp lệ. \\ \hline
    \end{tabularx}
\end{table}

\subsection{Khối chuyển đổi nối tiếp sang song song (SIPO)}
Gom các bit đơn lẻ từ TBU thành byte 8-bit hoàn chỉnh trước khi xuất ra ngoài hệ thống.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{sipo.png}
    \caption{Sơ đồ khối SIPO}
    \label{fig:sipo_block}
\end{figure}

\begin{table}[H]
    \centering
    \caption{Giao diện khối SIPO}
    \begin{tabularx}{\textwidth}{|l|c|c|X|}
    \hline
    \textbf{Tên tín hiệu} & \textbf{Độ rộng} & \textbf{Hướng} & \textbf{Mô tả} \\ \hline
    \texttt{clk} & 1 & I & Xung clock hệ thống. \\ \hline
    \texttt{rst\_n} & 1 & I & Reset hệ thống (Tích cực thấp). \\ \hline
    \texttt{data\_serial\_i} & 1 & I & Bit nhận từ TBU. \\ \hline
    \texttt{valid\_serial\_i}& 1 & I & Cờ báo bit đầu vào hợp lệ. \\ \hline
    \texttt{data\_parallel\_o}& 8 & O & Dữ liệu byte hoàn chỉnh. \\ \hline
    \texttt{byte\_ready\_o} & 1 & O & Báo hiệu đã đủ 8 bit (Byte Valid). \\ \hline
    \end{tabularx}
\end{table}

\section{Triển khai RTL (RTL Implementation)}
Mã nguồn RTL được viết bằng Verilog HDL.
Trước khi đi vào chi tiết, sơ đồ khối hệ thống (Hình \ref{fig:system_block}) và lưu đồ thuật toán (Hình \ref{fig:algo_flow}) minh họa luồng xử lý tổng quan.

\begin{figure}[H]
    \centering
    \includegraphics[width=1.0\textwidth]{so_do_khoi.drawio.png}
    \caption{Sơ đồ khối chi tiết hệ thống Viterbi Decoder SoC}
    \label{fig:system_block}
\end{figure}

Lưu đồ thuật toán điều khiển luồng dữ liệu:

\begin{figure}[H]
    \centering
    \includegraphics[width=0.85\textwidth]{luu_do_thuat_toan.drawio.png}
    \caption{Lưu đồ thuật toán điều khiển luồng dữ liệu hệ thống}
    \label{fig:algo_flow}
\end{figure}
\newpage

Thay vì sử dụng bộ nhớ RAM để lưu vết và quay lui (Traceback) gây độ trễ lớn, nhóm sử dụng kỹ thuật \textbf{Register Exchange (RE)} trong khối TBU. 

Mỗi trạng thái ($S_0, S_1, S_2, S_3$) quản lý một thanh ghi dịch lịch sử dài 15 bit.
\begin{lstlisting}[language=Verilog, caption=Cơ chế Register Exchange trong TBU]
// Update logic example for state S0
if (dec_bits_i[0] == 0) 
    history_s0 <= {history_s0[TBL-2:0], 1'b0}; // Select path from previous S0
else                    
    history_s0 <= {history_s1[TBL-2:0], 1'b0}; // Select path from previous S1
\end{lstlisting}

Nhờ cơ chế này, sau khi pipeline được điền đầy (15 chu kỳ), đầu ra dữ liệu là liên tục (streaming) với năng suất (throughput) cao nhất (1 bit/cycle).

% ====================================================================
% CHƯƠNG 3
% ====================================================================
\chapter{KIỂM TRA CHỨC NĂNG MẠCH}

\section{Môi trường kiểm chứng (Testbench Environment)}
Môi trường kiểm tra được xây dựng trong file \texttt{tb\_system\_top.sv} với các thành phần:
\begin{itemize}
    \item \textbf{Generator}: Tạo ngẫu nhiên 1025 gói dữ liệu 16-bit.
    \item \textbf{Driver}: Đưa dữ liệu vào hệ thống qua giao thức bắt tay (valid/busy).
    \item \textbf{Monitor}: Thu thập dữ liệu đầu ra \texttt{data\_o}.
    \item \textbf{Scoreboard}: So sánh kết quả mô phỏng với "Golden Model" (mô hình chuẩn).
\end{itemize}

\section{Kết quả mô phỏng (Simulation Results)}
Dưới đây là kết quả mô phỏng chi tiết cho từng khối chức năng (Unit Level) và toàn hệ thống (System Level). Các hình ảnh bao gồm log dữ liệu và giản đồ sóng xác nhận hoạt động chính xác của thiết kế.

% --- FIFO ---
\subsection{Khối đệm dữ liệu (FIFO)}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{fifo_log_part1.png}
    \caption{Log mô phỏng FIFO - Phần 1}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{fifo_log_part2.png}
    \caption{Log mô phỏng FIFO - Phần 2}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.85\textwidth]{fifo_wave.png}
    \caption{Giản đồ sóng tín hiệu FIFO}
\end{figure}

% --- PISO ---
\subsection{Khối chuyển đổi song song sang nối tiếp (PISO)}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{piso_log_part1.png}
    \caption{Log mô phỏng PISO - Phần 1}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{piso_log_part2.png}
    \caption{Log mô phỏng PISO - Phần 2}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.85\textwidth]{piso_wave.png}
    \caption{Giản đồ sóng tín hiệu PISO}
\end{figure}

% --- BMU ---
\subsection{Khối tính toán nhánh (BMU)}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{bmu_log_part1.png}
    \caption{Log mô phỏng BMU - Phần 1}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{bmu_log_part2.png}
    \caption{Log mô phỏng BMU - Phần 2}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.85\textwidth]{bmu_wave.png}
    \caption{Giản đồ sóng tín hiệu BMU}
\end{figure}

% --- ACSU ---
\subsection{Khối Cộng - So sánh - Chọn (ACSU)}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{acsu_log_part1.png}
    \caption{Log mô phỏng ACSU - Phần 1}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{acsu_log_part2.png}
    \caption{Log mô phỏng ACSU - Phần 2}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.85\textwidth]{acsu_wave.png}
    \caption{Giản đồ sóng tín hiệu ACSU}
\end{figure}

% --- PMU ---
\subsection{Khối quản lý Metric (PMU)}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{pmu_log_part1.png}
    \caption{Log mô phỏng PMU - Phần 1}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{pmu_log_part2.png}
    \caption{Log mô phỏng PMU - Phần 2}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.85\textwidth]{pmu_wave.png}
    \caption{Giản đồ sóng tín hiệu PMU}
\end{figure}

% --- TBU ---
\subsection{Khối truy vết (TBU)}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{tbu_log_part1.png}
    \caption{Log mô phỏng TBU - Phần 1}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{tbu_log_part2.png}
    \caption{Log mô phỏng TBU - Phần 2}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.85\textwidth]{tbu_wave.png}
    \caption{Giản đồ sóng tín hiệu TBU}
\end{figure}

% --- SIPO ---
\subsection{Khối chuyển đổi nối tiếp sang song song (SIPO)}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{sipo_log_part1.png}
    \caption{Log mô phỏng SIPO - Phần 1}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{sipo_log_part2.png}
    \caption{Log mô phỏng SIPO - Phần 2}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.85\textwidth]{sipo_wave.png}
    \caption{Giản đồ sóng tín hiệu SIPO}
\end{figure}
% ====================================================================
% SECTION 3.2.8: SYSTEM VERIFICATION
% ====================================================================
\subsection{Kiểm chứng toàn hệ thống (System Integration)}

Sau khi các khối đơn lẻ (Unit Level) đã hoạt động đúng, nhóm thực hiện tích hợp toàn bộ hệ thống và tiến hành kiểm thử mức hệ thống (System Level Verification). Mục tiêu là đảm bảo luồng dữ liệu từ FIFO $\rightarrow$ PISO $\rightarrow$ Viterbi Core $\rightarrow$ SIPO hoạt động đồng bộ, đúng timing và quan trọng nhất là khả năng sửa lỗi của thuật toán.

\subsubsection{Kịch bản kiểm thử (Testcases)}

Hệ thống được kiểm tra với bộ Test Suite gồm 8 kịch bản chính, bao phủ từ hoạt động bình thường, khả năng sửa lỗi bit đến các trường hợp chịu tải cao (Stress test).

\begin{table}[H]
    \centering
    \caption{Tổng hợp kết quả các kịch bản kiểm thử hệ thống}
    \begin{tabularx}{\textwidth}{|l|l|X|l|}
    \hline
    \textbf{ID} & \textbf{Tên Testcase} & \textbf{Mô tả kịch bản} & \textbf{Kết quả} \\ \hline
    SYS\_01 & Sanity Check & Kiểm tra cơ bản: Gửi gói tin chuẩn, không lỗi. & \textbf{Pass} \\ \hline
    SYS\_02 & Full Range Sweep & Quét toàn bộ dải giá trị đầu vào (0x0000 - 0xFFFF). & \textbf{Pass} \\ \hline
    SYS\_03 & Single Bit Error & Gây nhiễu sai 1 bit ngẫu nhiên. Hệ thống phải tự sửa lại đúng. & \textbf{Pass} \\ \hline
    SYS\_04 & Multi-bit Error & Gây nhiễu sai 2-3 bit (Vượt quá khả năng sửa lỗi lý thuyết). & Mixed \\ \hline
    SYS\_05 & Burst Error & Kiểm tra khả năng chịu lỗi chùm (sai 4 bit liên tiếp). & Fail (Expected) \\ \hline
    SYS\_06 & Busy Ignore & Gửi dữ liệu khi cờ Busy=1 (FIFO đầy). & \textbf{Pass} \\ \hline
    SYS\_07 & Continuous Stress & Gửi dữ liệu liên tục tốc độ cao (Back-to-back transaction). & \textbf{Pass} \\ \hline
    SYS\_08 & Reset Recovery & Reset hệ thống giữa chừng khi đang xử lý. & \textbf{Pass} \\ \hline
    \end{tabularx}
\end{table}

\subsubsection{Mã nguồn Testbench (Trích đoạn)}

Module kiểm thử tự động (\texttt{tb\_system\_top.sv}) được xây dựng với cơ chế "Self-checking". Dưới đây là trích đoạn Task gửi dữ liệu có hỗ trợ tiêm lỗi (Error Injection):

\begin{lstlisting}[language=Verilog, caption=Task gửi dữ liệu và tiêm lỗi trong Testbench]
// Task: Send 16-bit data packet
task send_packet(input [15:0] data, input [2:0] error_count);
    logic [15:0] corrupted_data;
    begin
        // Inject artificial error to test error correction capability
        corrupted_data = inject_error(data, error_count);
        
        // Handshake protocol with the system
        wait(!busy_o);      // Wait for system ready
        @(posedge clk);
        dvalid_i = 1'b1;    // Assert Valid
        data_i   = corrupted_data;
        @(posedge clk);
        dvalid_i = 1'b0;
    end
endtask
\end{lstlisting}

\subsubsection{Kết quả mô phỏng}

Hình \ref{fig:test_summary} dưới đây là báo cáo tổng hợp tự động từ Testbench. Hệ thống đạt tỷ lệ thành công tuyệt đối (100\%) với các trường hợp dữ liệu sạch (Clean) và lỗi 1 bit (Error 1b).

\begin{figure}[H]
    \centering
    % Rename file 2dfaac... to test_summary.jpg
    \includegraphics[width=0.8\textwidth]{test_summary.jpg} 
    \caption{Bảng tổng kết (Test Summary Report) từ Simulation Log}
    \label{fig:test_summary}
\end{figure}

Chi tiết log mô phỏng của một số trường hợp tiêu biểu:

\begin{figure}[H]
    \centering
    % Rename file 0efb0a... to log_sys01.jpg
    \includegraphics[width=0.75\textwidth]{log_sys01.jpg}
    \caption{[SYS\_01] Sanity Check: Hệ thống giải mã chính xác dữ liệu chuẩn}
\end{figure}

\begin{figure}[H]
    \centering
    % Rename file 2985d1... to log_sys03.jpg
    \includegraphics[width=0.75\textwidth]{log_sys03.jpg}
    \caption{[SYS\_03] Single Bit Error: Hệ thống tự động sửa sai khi đầu vào bị lỗi 1 bit}
\end{figure}

\begin{figure}[H]
    \centering
    % Rename file f4e0ca... to log_sys07.jpg
    \includegraphics[width=0.75\textwidth]{log_sys07.jpg}
    \caption{[SYS\_07] Continuous Stress: Hoạt động ổn định dưới tải liên tục}
\end{figure}
% ====================================================================
% CHƯƠNG 4
% ====================================================================
\chapter{TỔNG HỢP VÀ THIẾT KẾ VẬT LÝ}

\section{Quy trình OpenLane Flow}
Thiết kế được đưa vào quy trình OpenLane để chuyển đổi từ RTL sang GDSII. Các bước thực hiện bao gồm:
\begin{enumerate}
    \item \textbf{Synthesis (Yosys)}: Tổng hợp logic và map vào thư viện cells Sky130.
    \item \textbf{Floorplan}: Định nghĩa kích thước die, tạo lưới nguồn (PDN).
    \item \textbf{Placement (OpenROAD)}: Đặt các cell vào khung layout, tối ưu hóa độ dài dây dẫn.
    \item \textbf{CTS}: Cân bằng cây xung clock để giảm Clock Skew.
    \item \textbf{Routing}: Đi dây chi tiết và kiểm tra luật thiết kế (DRC).
\end{enumerate}

\section{Kết quả tổng hợp (Synthesis Results)}
Báo cáo tổng hợp cho thấy tài nguyên phần cứng sử dụng rất hiệu quả:

\begin{table}[H]
    \centering
    \caption{Tài nguyên phần cứng sau tổng hợp}
    \begin{tabular}{|l|l|}
    \hline
    \textbf{Tài nguyên} & \textbf{Số lượng} \\ \hline
    Số lượng cổng logic (Combinational) & $\approx$ 1400 \\ \hline
    Số lượng Flip-Flops (Sequential) & $\approx$ 600 \\ \hline
    Tổng số Cells & 2032 \\ \hline
    Fanout tối đa & 10 \\ \hline
    \end{tabular}
\end{table}

\section{Kết quả thiết kế vật lý (Physical Layout)}
Sau khi hoàn tất Routing và Sign-off, các thông số vật lý cuối cùng ghi nhận được từ file \texttt{metrics.csv}:

\begin{itemize}
    \item \textbf{Diện tích (Die Area)}: $0.16 mm^2$.
    \item \textbf{Mật độ (Core Utilization)}: 40\% (Đảm bảo không gian cho routing và tránh tắc nghẽn).
    \item \textbf{Công suất tiêu thụ ước tính}: $0.007 mW$ (Tại điều kiện hoạt động điển hình).
    \item \textbf{Thời gian (Timing)}: 
        \begin{itemize}
            \item Worst Negative Slack (WNS): 4.15 ns.
            \item Tần số hoạt động tối đa: 50 MHz.
        \end{itemize}
    \item \textbf{Kiểm tra vật lý}: Không có vi phạm LVS (Layout Vs Schematic) và DRC (Design Rule Check).
\end{itemize}

\begin{figure}[H]
    \centering
    % Placeholder cho layout
    % \includegraphics[width=0.8\textwidth]{layout_gds.png}
    \caption{Hình ảnh Layout GDSII cuối cùng của hệ thống}
\end{figure}

% ====================================================================
% KẾT LUẬN
% ====================================================================
\chapter*{KẾT LUẬN}
\addcontentsline{toc}{chapter}{KẾT LUẬN}

Đồ án đã thiết kế và hiện thực hóa thành công một hệ thống Viterbi Decoder SoC từ mức ý tưởng đến Layout vật lý. Việc áp dụng thành công kỹ thuật \textbf{Register Exchange} đã chứng minh hiệu quả vượt trội trong việc xử lý dòng bit liên tục. Quy trình thiết kế sử dụng hoàn toàn các công cụ nguồn mở (OpenLane, Sky130, iVerilog) mở ra hướng đi khả thi và tiết kiệm chi phí cho việc thiết kế và sản xuất chip VLSI tại Việt Nam.

\newpage
\begin{thebibliography}{9}
\bibitem{viterbi} A. J. Viterbi, "Error bounds for convolutional codes and an asymptotically optimum decoding algorithm," IEEE Transactions on Information Theory.
\bibitem{openlane} OpenLane Documentation, "The Open-Source Digital ASIC Implementation Flow".
\bibitem{sky130} SkyWater SKY130 PDK, Google Open Source Silicon.
\end{thebibliography}

\end{document}